# Broken for 4.17, TODO: update if needed again to restore times.
#Manipulate reading stats:
#  - Enabled: no
#  - Description: Always add 10 hours to the reading time every time you close a book.
#  # in EventEngine::endReadingSession(*Volume) when recording end of reading session stats, change QDateTime::secsTo calls to a fixed value
#  - ReplaceBytes: {Offset: 0x4F429C, FindBLX: 0x441348, ReplaceH: 4F F6 FF 70} # MOV  r0, #65535
#  - ReplaceBytes: {Offset: 0x4F42BC, FindBLX: 0x441348, ReplaceH: 4F F6 FF 70} # MOV  r0, #65535

Stuff: [Enabled: yes, ReplaceBytes: {Offset: 0x6A8632, FindH: FFF520EB, ReplaceH: 4FF00100}, ReplaceBytes: {Offset: 0x70CDC6, FindH: 89F582EB, ReplaceH: 4FF00100}, ReplaceBytes: {Offset: 0x7119C2, FindH: 84F584ED, ReplaceH: 4FF00100}]

Show natural light menu on all devices:
  - Enabled: yes
  - Description: |
      Just for testing the light memu, will show the slider and dropdown,
      but won't actually do anything other than change the config file.
  # Show slider in FrontLightPopupController::loadView:
  - ReplaceBytes: {Offset: 0xA51E8A, FindBLX: 0x4C8984, ReplaceH: 4F F0 01 00}
  - ReplaceBytes: {Offset: 0xA51FC8, FindBLX: 0x4C8984, ReplaceH: 4F F0 01 00}

Invert page turn buttons:
  - Enabled: no
  # In ReadingView::keyPressEvent(QKeyEvent*), invert the branch to next page:
  - ReplaceBytes: {Offset: 0xAD2824, FindH: 28 B9, ReplaceH: 28 B1} # CBNZ R0, #0xE -> CBZ R0, #0xE

Allow USB storage even when device locked:
  - Enabled: no
  - Description: |
      Always allows USB storage even when the device is locked. When combined
      with an enabled lock screen, this patch allows recovery from almost any
      segfaulting patch without a factory reset, as most code isn't executed
      until after the initial unlock. WARNING - this patches renders the lock
      screen security completely useless! But, for some security by obscurity
      this will only take effect when you plug it in while the sleep screen is
      visible.
  # Never reject the permission request (i.e. don't set *r5 = false), even when
  # the PIN entry dialog is enabled:
  - ReplaceBytesAtSymbol: {Symbol: "N3PowerWorkflowManager::onUSBPlugPermissionRequest(PermissionRequest*)", Offset: 39, FindH: 2B 70, ReplaceH: 00 46} # strb r3, [r5] -> NOP

### Hide top-left menu items ###
# This following patches take advantage of the parental controls feature, as
# StatusBarMenuController::updateParentControlSensitiveMenuItems is always
# called when setting them up. All that is needed to hide items is to hardcode
# false before calling QAction::setVisible ([XX 46] mov r1, XX -> [00 21] movs r1, #0).
# To prevent ghost items, the value which stores the number of items to draw
# also needs to be fixed before the ldrex/strex just after the setVisible.

Hide top-left menu item - Dropbox:
  - Enabled: no
  - Description: See the comment above.
  - FindBaseAddressSymbol: "StatusBarMenuController::updateParentControlSensitiveMenuItems()"
  - ReplaceBytes: {Offset:  181, FindH: 51 46, ReplaceH: 00 21} # DropboxSeparator (sl=51) (sl:sb&r5)
  - ReplaceBytes: {Offset:  203, FindH: 51 46, ReplaceH: 00 21} # DropboxSeparator (sl=51)
  - ReplaceBytes: {Offset:  305, FindH: 49 46, ReplaceH: 00 21} # DropboxWidget (sb=49) (sb:sb&r5)
  - ReplaceBytes: {Offset:  327, FindH: 49 46, ReplaceH: 00 21} # DropboxWidget (sb=49)

Hide top-left menu item - Pocket:
  - Enabled: no
  - Description: See the comment above.
  - FindBaseAddressSymbol: "StatusBarMenuController::updateParentControlSensitiveMenuItems()"
  - ReplaceBytes: {Offset:  483, FindH: 29 46, ReplaceH: 00 21} # PocketSeparator (r5=29)
  - ReplaceBytes: {Offset:  505, FindH: 29 46, ReplaceH: 00 21} # PocketSeparator (r5=29)
  - ReplaceBytes: {Offset:  661, FindH: 29 46, ReplaceH: 00 21} # PocketWidget (r5=29)
  - ReplaceBytes: {Offset:  683, FindH: 29 46, ReplaceH: 00 21} # PocketWidget (r5=29)

Hide top-left menu item - Store:
  - Enabled: no
  - Description: See the comment above.
  - FindBaseAddressSymbol: "StatusBarMenuController::updateParentControlSensitiveMenuItems()"
  - ReplaceBytes: {Offset:  839, FindH: 29 46, ReplaceH: 00 21} # StoreSeparator (r5=29)
  - ReplaceBytes: {Offset:  861, FindH: 29 46, ReplaceH: 00 21} # StoreSeparator (r5=29)
  - ReplaceBytes: {Offset: 1017, FindH: 29 46, ReplaceH: 00 21} # StoreWidget (r5=29)
  - ReplaceBytes: {Offset: 1039, FindH: 29 46, ReplaceH: 00 21} # StoreWidget (r5=29)

Hide top-left menu item - Recommended:
  - Enabled: no
  - Description: See the comment above.
  - FindBaseAddressSymbol: "StatusBarMenuController::updateParentControlSensitiveMenuItems()"
  - ReplaceBytes: {Offset: 1195, FindH: 29 46, ReplaceH: 00 21} # RecommendedSeparator (r5=29)
  - ReplaceBytes: {Offset: 1217, FindH: 29 46, ReplaceH: 00 21} # RecommendedSeparator (r5=29)
  - ReplaceBytes: {Offset: 1373, FindH: 29 46, ReplaceH: 00 21} # RecommendedWidget (r5=29)
  - ReplaceBytes: {Offset: 1395, FindH: 29 46, ReplaceH: 00 21} # RecommendedWidget (r5=29)

# Note about updating: the following ones were mistakenly detected as outside
# the procedure by Hopper, but this can be fixed by NOPing the DDs between and
# recreating the procedure (press P at the start).

Hide top-left menu item - Wishlist:
  - Enabled: no
  - Description: See the comment above.
  - FindBaseAddressSymbol: "StatusBarMenuController::updateParentControlSensitiveMenuItems()"
  - ReplaceBytes: {Offset: 5023, FindH: 59 46, ReplaceH: 00 21} # WishlistSeparator (fp=59) (fp:r8&r5)
  - ReplaceBytes: {Offset: 5045, FindH: 59 46, ReplaceH: 00 21} # WishlistSeparator (fp=59)
  - ReplaceBytes: {Offset: 5143, FindH: 41 46, ReplaceH: 00 21} # WishlistWidget (r8=41) (r8:r8&r5)
  - ReplaceBytes: {Offset: 5165, FindH: 41 46, ReplaceH: 00 21} # WishlistWidget (r8=41)

Hide top-left menu item - Activity:
  - Enabled: no
  - Description: See the comment above.
  - FindBaseAddressSymbol: "StatusBarMenuController::updateParentControlSensitiveMenuItems()"
  - ReplaceBytes: {Offset: 5653, FindH: 29 46, ReplaceH: 00 21} # ActivitySeparator (r5=29)
  - ReplaceBytes: {Offset: 5675, FindH: 29 46, ReplaceH: 00 21} # ActivitySeparator (r5=29)
  - ReplaceBytes: {Offset: 6029, FindH: 29 46, ReplaceH: 00 21} # ActivityWidget (r5=29)
  - ReplaceBytes: {Offset: 6051, FindH: 29 46, ReplaceH: 00 21} # ActivityWidget (r5=29)

### Change Browse Kobo home screen link target ###
# This patch allows you to change the target of the Browse Kobo link. To
# rename the top description, use the rename home screen footer patch.
#
# The easy options for this patch are fairly limited, as BrowseKoboWidget::tapped
# just calls the superclass event, then the call to DiscoverNavMixin::storeFront
# in the PLT is tail-call optimized. This places a number of restrictions on the
# replacement target, namely: the branch must be a branch and exchange, but not
# link (lr must be unchanged to return correctly), which is implemented as a
# 32-bit branch to a bx pc (nop branch, but still switch instruction sets)
# immediately before a PLT entry to a nav mixin without any arguments (i.e.
# must be static). Note that the first branch is relative to pc. Also, note that
# in general, tbis requirement means anything called by StatusBarController (the
# menu) can be used as a replacement.
#
# Basically, the following two steps are needed:
# - In BrowseKoboWidget::tapped, change the tail-call to the bx before
#   [something]NavMixin::[something] in the PLT.
# - In the BrowseKoboWidget constructor, change which function is called to get
#   the bottom text (Shop Kobo) from N3DeviceCharm::shopName (Shop Kobo / Walmart)
#   to N3DeviceCharm::[something] (note that there isn't enough room to
#   load an entirely different string here).

Change Browse Kobo home screen link target - Activity:
  - Enabled: no
  - Description: See the comment above.
  - ReplaceBytes: {Offset: 0x9AB1BA, FindH: F2 F6 AB B2, ReplaceH: E8 F6 3F B6} # tail call to bx before ReadingLifeNavMixin::chooseActivity (sub_493e3c)
  - ReplaceBLX:   {Offset: 0x9AAB7A, Find: 0x4AF398,     Replace: 0x4A29EC}     # N3DeviceCharm::extrasName (Activity)

Change Browse Kobo home screen link target - Articles:
  - Enabled: no
  - Description: See the comment above.
  - ReplaceBytes: {Offset: 0x9AB1BA, FindH: F2 F6 AB B2, ReplaceH: 0C F7 C9 B7} # tail call to bx before LibraryNavMixin::showPocketLibrary (sub_4b8150)
  - ReplaceBLX:   {Offset: 0x9AAB7A, Find: 0x4AF398,     Replace: 0x4BD3E8}     # N3DeviceCharm::articlesSearchName (My Articles)
